[env:m5stack-core-esp32]
platform = espressif32
board = m5stack-core-esp32
framework = arduino
monitor_speed = 115200
monitor_filters = esp32_exception_decoder, time

; Optimize for timing-critical slave operations
build_flags = 
    -DCORE_DEBUG_LEVEL=3
    -DCONFIG_FREERTOS_HZ=1000
    -DCONFIG_ESP32_DEFAULT_CPU_FREQ_240=1
    -DSLAVE_DEVICE=1
    -O2

; Libraries for M5Stack and RS485 communication
lib_deps = 
    m5stack/M5Stack@^0.4.6
    feilipu/FreeRTOS@^10.5.1-3
    
; Upload settings
upload_speed = 921600
upload_port = AUTO

; Monitor settings for debugging
monitor_port = AUTO

[env:debug]
extends = env:m5stack-core-esp32
build_type = debug
build_flags = 
    ${env:m5stack-core-esp32.build_flags}
    -DDEBUG_CRESTRON_SLAVE=1
    -DDEBUG_RS485_SLAVE=1
    -DDEBUG_PROTOCOL=1